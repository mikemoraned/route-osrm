<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basic</title>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
    <style>
        html, body, #map {
            height: 100%;
            padding: 0;
            margin: 0;
        }
    </style>

    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
</head>
<body>
    <div id="map"></div>

    <!-- include cartodb.js library -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
    <script src="ngeohash.js"></script>

    <script>
        function main() {
            var map = new L.Map('map', {
                center: [0,0],
                zoom: 2
            });

            L.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png', {
                attribution: 'Stamen'
            }).addTo(map);

            cartodb.createLayer(map, 'https://mikemoran.cartodb.com/api/v2/viz/e31380bc-af12-11e5-b443-0ea31932ec1d/viz.json')
                    .addTo(map)
                    .done(function() {
                        map.on('click', function(e) {
                            console.log(e);
                            var hash = NGeoHash.encode(e.latlng.lat, e.latlng.lng, 4);
                            console.log(hash);
                            var bb = NGeoHash.decode_bbox(hash);
                            var southWest = L.latLng(40.712, -74.227),
                                    northEast = L.latLng(40.774, -74.125),
                                    bounds = L.latLngBounds(southWest, northEast);
                            var rect = L.rectangle(bounds, {color: "#ff7800", weight: 1});
                            console.dir(rect);
                            rect.addTo(map);
                        });
                    })
                    .error(function(err) {
                        console.log(err);
                    });
        }
        window.onload = main;
    </script>
</body>
</html>